<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="theme.css">
</head>
<body class="sidebar-page">
  <p>Participantes</p>
  <ul id="participants"></ul>
  <script type="text/javascript">
    var API_BASE = 'http://localhost:3000/api';
    var el = document.getElementById('participants');
    fetch(API_BASE + '/participants')
      .then(function(r) { return r.json(); })
      .then(function(participants) {
        el.innerHTML = '';
        for (var i = 0; i < participants.length; i++) {
          var p = participants[i];
          var li = document.createElement('li');
          li.setAttribute('data-id', String(p.id));
          if (p.name === 'VocÃª') li.className = 'you';
          li.textContent = p.name;
          li.style.cursor = 'pointer';
          li.onclick = function() {
            var id = this.getAttribute('data-id');
            var val = (id === '1') ? '' : id;
            parent.postMessage({ type: 'setRecipient', recipientId: val }, '*');
          };
          el.appendChild(li);
        }
      })
      .catch(function() { el.innerHTML = '<li>Erro ao carregar</li>'; });
  </script>
</body>
</html>
